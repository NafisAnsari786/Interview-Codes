<img src="https://img.shields.io/badge/MEDIUM-orange" alt="MEDIUM" width="70">

ğŒğ®ğ¬ğ­ ğ“ğ«ğ²: Amazon(Medium Level) hashtag#SQL Interview Question â€” Solution

Write a query that'll identify returning active users. A returning active user is a user that has made a second purchase within 7 days of any other of their purchases. Output a list of user_ids of these returning active users.

ğŸ” By solving this, you'll learn how to use self join. Give it a try and share the output! ğŸ‘‡

ğ’ğœğ¡ğğ¦ğš ğšğ§ğ ğƒğšğ­ğšğ¬ğğ­:
CREATE TABLE amazon_transactions(id int, user_id int, item varchar(15), created_at datetime, revenue int);

INSERT INTO amazon_transactions VALUES (1,109,'milk','2020-03-03 00:00:00',123),(2,139,'biscuit','2020-03-18 00:00:00', 421), (3,120,'milk','2020-03-18 00:00:00',176), (4,108,'banana','2020-03-18 00:00:00',862), (5,130,'milk','2020-03-28 00:00:00',333), (6,103,'bread','2020-03-29 00:00:00',862), (7,122,'banana','2020-03-07 00:00:00',952), (8,125,'bread','2020-03-13 00:00:00',317), (9,139,'bread','2020-03-30 00:00:00',929), (10,141,'banana','2020-03-17 00:00:00',812), (11,116,'bread','2020-03-31 00:00:00',226), (12,128,'bread','2020-03-04 00:00:00',112), (13,146,'biscuit','2020-03-04 00:00:00',362), (14,119,'banana','2020-03-28 00:00:00',127), (15,142,'bread','2020-03-09 00:00:00',503), (16,122,'bread','2020-03-06 00:00:00',593), (17,128,'biscuit','2020-03-24 00:00:00',160), (18,112,'banana','2020-03-24 00:00:00',262), (19,149,'banana','2020-03-29 00:00:00',382), (20,100,'banana','2020-03-18 00:00:00',599);
------------

I have provided an explanation and query, but I encourage you to try solving it first. Later, you can check the query for reference.

ğ„ğ±ğ©ğ¥ğšğ§ğšğ­ğ¢ğ¨ğ§ ğ­ğ¨ ğ’ğ¨ğ¥ğ¯ğ ğğ®ğğ«ğ²
1. Self-Join: We join the amazon_transactions table (a) with itself (b) to compare each purchase by a user with their other purchases.

2. Conditions: a.user_id = b.user_id ensures weâ€™re only looking at transactions from the same user. a.created_at < b.created_at ensures that weâ€™re checking subsequent purchases. DATEDIFF(day, a.created_at, b.created_at) <= 7 filters for cases where the subsequent purchase was made within 7 days of the initial purchase.

3. DISTINCT user_id: We use DISTINCT to ensure each user_id only appears once in the output list, identifying each user as a returning active user.

**SOLUTION**

<img width="800" height="510" alt="image" src="https://github.com/user-attachments/assets/073ffbb1-e65c-4e25-9f81-2acaa91e8ffb" />
