<img src="https://img.shields.io/badge/MEDIUM-orange" alt="MEDIUM" width="70">

ğŒğ®ğ¬ğ­ ğ“ğ«ğ²: KPMG (Medium Level) hashtag#SQL Interview Question â€” Solution

Identify the second-highest salary in each department.

Your output should include the department, the second highest salary, and the employee ID. Do not remove duplicate salaries when ordering salaries, and apply the rankings without a gap in the rank. For example, if multiple employees share the same highest salary, the second-highest salary will be the next salary that is lower than the highest salaries.

ğŸŒ€By solving this, you'll learn how to use Cte, Windows function. Give it a try and share the output! ğŸ‘‡

ğ’ğœğ¡ğğ¦ğš ğšğ§ğ ğƒğšğ­ğšğ¬ğğ­
CREATE TABLE employee_data (department VARCHAR(100), employee_id BIGINT, hire_date DATETIME, rank FLOAT, salary BIGINT);

INSERT INTO employee_data (department, employee_id, hire_date, rank, salary) VALUES ('HR', 101, '2022-01-15', 5.0, 60000), ('HR', 102, '2021-03-10', 4.5, 75000), ('HR', 103, '2020-05-20', 4.2, 75000), ('HR', 104, '2023-06-01', 4.0, 50000), ('Finance', 201, '2020-07-15', 3.8, 85000), ('Finance', 202, '2021-09-25', 4.1, 95000), ('Finance', 203, '2023-03-30', 4.3, 95000), ('Finance', 204, '2022-11-12', 4.0, 70000), ('IT', 301, '2021-12-11', 5.0, 120000), ('IT', 302, '2023-01-15', 4.5, 110000), ('IT', 303, '2020-08-19', 4.8, 105000), ('IT', 304, '2021-06-30', 4.1, 100000), ('Sales', 401, '2019-11-20', 4.7, 65000), ('Sales', 402, '2022-02-10', 4.5, 55000), ('Sales', 403, '2020-01-25', 4.3, 75000), ('Sales', 404, '2023-07-18', 4.0, 72000);
---------

ğ„ğ±ğ©ğ¥ğšğ§ğšğ­ğ¢ğ¨ğ§ ğ­ğ¨ ğ’ğ¨ğ¥ğ¯ğ ğğ®ğğ«ğ²
1. RANK() Function: Assigns a rank to each employeeâ€™s salary within their department. The ranking is based on the salary column in descending order (ORDER BY salary DESC). The PARTITION BY department ensures the ranking is reset for each department.

2. WITH RankedSalaries: This Common Table Expression (CTE) creates a temporary result set with the ranks assigned to each employee in their department. salary_rank = 2: The query filters the rows where the rank is 2, which corresponds to the second-highest salary for each department.

**SOLUTION**

<img width="800" height="502" alt="image" src="https://github.com/user-attachments/assets/d7ad6dea-845a-4824-864e-ac2dbfa94e00" />
